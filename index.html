<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.0.0/docx.js"></script>
</head>
<body>
    <h1>Input Data to Generate DOCX</h1>
    <form id="docForm">
        <div id="entries">
            <div class="entry">
                <label for="coordinates">Coordinates:</label>
                <input type="text" name="coordinates" required><br><br>

                <label for="description">Description:</label>
                <textarea name="description" required></textarea><br><br>

                <label for="image">Image:</label>
                <input type="file" name="image" accept="image/*" required><br><br>
            </div>
        </div>
        <button type="button" onclick="addEntry()">Add Another Entry</button><br><br>
        <button type="submit">Generate DOCX</button>
    </form>

    <script>
        function addEntry() {
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <label for="coordinates">Coordinates:</label>
                <input type="text" name="coordinates" required><br><br>

                <label for="description">Description:</label>
                <textarea name="description" required></textarea><br><br>

                <label for="image">Image:</label>
                <input type="file" name="image" accept="image/*" required><br><br>
            `;
            document.getElementById('entries').appendChild(entry);
        }

        document.getElementById('docForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const entries = document.getElementsByClassName('entry');
            const doc = new docx.Document();

            for (let entry of entries) {
                const coordinates = entry.querySelector('input[name="coordinates"]').value;
                const description = entry.querySelector('textarea[name="description"]').value;
                const imageFile = entry.querySelector('input[name="image"]').files[0];

                doc.addSection({
                    children: [
                        new docx.Paragraph(`Coordinates: ${coordinates}`),
                        new docx.Paragraph(`Description: ${description}`),
                        new docx.Paragraph('Image:'),
                        await createImageParagraph(imageFile),
                    ],
                });
            }

            docx.Packer.toBlob(doc).then(blob => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'document.docx';
                link.click();
            });
        });

        async function createImageParagraph(file) {
            const reader = new FileReader();
            return new Promise((resolve, reject) => {
                reader.onload = function(event) {
                    const image = new docx.ImageRun({
                        data: event.target.result,
                        transformation: { width: 100, height: 100 }
                    });

                    resolve(new docx.Paragraph({
                        children: [image],
                    }));
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
    </script>
</body>
</html>
