<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Dofinner</h1>
    *maks 5 doer og last ned eller risikerer du at mister informasjon*
    <form id="docForm">
        <div id="entries">
            <div class="entry">
                <label for="coordinates">koordinater fra google maps:</label>
                <input type="text" name="coordinates" required placeholder="lim inn"><br><br>

                <label for="description">Informasjon:</label>
                <textarea name="description" required placeholder="Navn, adresse, hvor mange doer, kvalitet"></textarea><br><br>

                <label for="image">Bilder:</label>
                <input type="file" name="image" accept="image/*" required><br><br>
            </div>
        </div>
        <button type="button" onclick="addEntry()">LEGG TIL FLERE DOER</button><br><br>
        <button type="submit">last ned pdf</button>
    </form>

    <script>
        function addEntry() {
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <label for="coordinates">koordinater fra google maps:</label>
                <input type="text" name="coordinates" required placeholder="lim inn"><br><br>

                <label for="description">Informasjon:</label>
                <textarea name="description" required placeholder="Navn, adresse, hvor mange doer, kvalitet"></textarea><br><br>

                <label for="image">Bilder:</label>
                <input type="file" name="image" accept="image/*" required><br><br>
            `;
            document.getElementById('entries').appendChild(entry);
        }

        document.getElementById('docForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const entries = document.getElementsByClassName('entry');

            let yOffset = 10; // Y offset for PDF content

            for (let entry of entries) {
                const coordinates = entry.querySelector('input[name="coordinates"]').value;
                const cleanedCoordinates = coordinates.replace(/[()]/g, ''); // Remove parentheses
                const [lat, lon] = cleanedCoordinates.split(',').map(coord => coord.trim());
                const swappedCoordinates = `[${lon}, ${lat}]`;

                const description = entry.querySelector('textarea[name="description"]').value;
                const imageFile = entry.querySelector('input[name="image"]').files[0];

                doc.text(`Coordinates: ${swappedCoordinates}`, 10, yOffset);
                yOffset += 10;
                doc.text(`Description: ${description}`, 10, yOffset);
                yOffset += 20;

                if (imageFile) {
                    const imageDataUrl = await readFileAsDataURL(imageFile);
                    doc.addImage(imageDataUrl, 'JPEG', 10, yOffset, 50, 50);
                    yOffset += 60; // Adjust yOffset to account for image height
                }

                yOffset += 20; // Add space between entries
            }

            doc.save('document.pdf');
        });

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
